# 计算机组成原理与系统结构 复习笔记

本笔记依据提供的目录结构编写，涵盖核心知识点、常见考点及典型题目解析。

---

## 第一篇 基础知识

### 第1章 绪论

#### 1. 核心知识点
*   **冯·诺依曼体系结构 (Stored Program Concept)**:
    *   计算机由 **运算器、控制器、存储器、输入设备、输出设备** 五大部件组成。
    *   指令和数据以同等地位存储在存储器中，可按地址寻址。
    *   指令和数据均用二进制表示。
    *   指令由操作码和地址码组成。
    *   **存储程序**：程序预先存入存储器，计算机自动逐条取出指令执行。
*   **计算机系统层次结构**:
    *   硬件 -> 微程序 -> 机器语言 -> 操作系统 -> 汇编语言 -> 高级语言 -> 应用语言。
    *   硬件与软件在逻辑功能上是等价的（如浮点运算可用硬件电路实现，也可用软件模拟）。
*   **性能指标**:
    *   **机器字长**: CPU一次能处理的数据位数（如32位、64位）。
    *   **主频 (Clock Rate)**: CPU时钟频率。
    *   **CPI (Cycles Per Instruction)**: 执行一条指令所需的时钟周期数。
    *   **MIPS (Million Instructions Per Second)**: 每秒执行百万条指令数 ($MIPS = \frac{f}{CPI \times 10^6}$).
    *   **吞吐量 (Throughput)**: 单位时间内处理的信息量。
    *   **响应时间 (Response Time)**: 从提交请求到获得结果的时间。

#### 2. 常见考点
*   **冯·诺依曼特点**: 选择题常考，特别是“指令和数据同等存储”和“顺序执行”的特点。
*   **性能计算**: 给定主频、CPI、指令条数，计算CPU执行时间或MIPS。
    *   公式：$T_{CPU} = \frac{Instruction\_Count \times CPI}{Frequency}$

#### 3. 典型题目与讲解
> **题目**: 某计算机主频为 1.2 GHz，其指令分为 A、B、C 三类，CPI 分别为 2, 3, 4。某程序中三类指令的比例分别为 50%, 30%, 20%。求该程序的平均 CPI 和 MIPS。
>
> **讲解**:
> 1.  **平均 CPI**: $CPI_{avg} = \sum (Ratio_i \times CPI_i) = 0.5 \times 2 + 0.3 \times 3 + 0.2 \times 4 = 1.0 + 0.9 + 0.8 = 2.7$
> 2.  **MIPS**: $MIPS = \frac{f}{CPI_{avg} \times 10^6} = \frac{1.2 \times 10^9}{2.7 \times 10^6} \approx 444.4$

---

### 第2章 信息表示

#### 1. 核心知识点
*   **数值表示**:
    *   **原码 (True Form)**: 最高位符号位 (0正1负)，其余为数值。0有两种表示 (+0, -0)。
    *   **补码 (Two's Complement)**: 正数同原码；负数符号位不变，数值位取反加1。**0只有一种表示**。适合加减运算。
    *   **反码 (One's Complement)**: 负数符号位不变，数值位取反。
    *   **移码 (Bias)**: 通常用于浮点数阶码，等于真值 + 偏置值 (如 $2^{n-1}$)。
*   **定点与浮点**:
    *   **定点数**: 小数点固定（通常在纯整数或纯小数位置）。
    *   **浮点数 (IEEE 754)**: $N = (-1)^S \times 1.M \times 2^{E-127}$ (单精度 32位: 1位符号, 8位阶码, 23位尾数)。
*   **字符编码**:
    *   **ASCII**: 7位编码，最高位常用于奇偶校验。
    *   **汉字编码**: 输入码 -> 国标码 -> 机内码 -> 字形码。
*   **指令格式**:
    *   **操作码 (Opcode)** + **地址码 (Operand)**。
    *   **寻址方式**:
        *   **立即寻址**: 操作数在指令中 (MOV AX, 100)。
        *   **寄存器寻址**: 操作数在寄存器中 (MOV AX, BX)。
        *   **直接寻址**: 指令给出内存地址 (MOV AX, [1000H])。
        *   **寄存器间接寻址**: 地址在寄存器中 (MOV AX, [BX])。
        *   **基址/变址/相对寻址**: 地址 = 寄存器值 + 偏移量。
*   **CISC vs RISC**:
    *   **CISC (Complex)**: 指令多且复杂，长度可变，寻址方式多。
    *   **RISC (Reduced)**: 指令少且简单，定长，主要依赖寄存器，流水线优化好。

#### 2. 常见考点
*   **进制转换与补码运算**: 给定十进制求补码，或补码加减法判断溢出。
*   **IEEE 754 浮点数**: 给定十六进制机器数求真值，或反之。
*   **寻址方式**: 给出汇编指令，判断源/目的操作数的寻址方式。
*   **溢出判断**: 双符号位法 (00/11正常, 01/10溢出) 或 进位判断法。

#### 3. 典型题目与讲解
> **题目**: 若寄存器AL的内容为 $80H$，当执行“ADD AL, AL”指令后，CF (进位标志) 和 OF (溢出标志) 的状态分别为？(假设视为带符号数)
>
> **讲解**:
> 1.  $80H = 1000\_0000B$。
> 2.  $1000\_0000 + 1000\_0000 = 1\_0000\_0000B$。
> 3.  结果为 $00H$，进位 $1$，所以 $CF = 1$。
> 4.  视为带符号数：$80H$ 是 $-128$ (补码)。$-128 + (-128) = -256$。8位补码范围是 $[-128, +127]$，$-256$ 超出范围，发生溢出，$OF = 1$。
> 5.  (或者用双符号位判别：符号位由1变0，出错)

> **题目**: 将十进制数 -10.75 转换为 IEEE 754 单精度浮点数格式（十六进制表示）。
>
> **讲解**:
> 1.  符号位 $S = 1$ (负数)。
> 2.  绝对值 $10.75 = 1010.11_2 = 1.01011 \times 2^3$。
> 3.  阶码 $E = 3 + 127 = 130 = 1000\_0010_2$。
> 4.  尾数 $M = 0101100...0$ (去掉隐含的1，补足23位)。
> 5.  组合: $1$ (S) | $10000010$ (E) | $01011000000000000000000$ (M)。
> 6.  二进制串: $1100\_0001\_0010\_1100\_...$
> 7.  十六进制: $C12C0000H$。


---

## 第二篇 计算机系统结构

### 第3章 微体系结构层

#### 1. 核心知识点
*   **CPU组成**: ALU (运算), Registers (存储), Control Unit (控制).
    *   **PC (Program Counter)**: 存放下一条指令地址。
    *   **IR (Instruction Register)**: 存放当前指令。
    *   **MAR/MDR**: 存储器地址/数据寄存器。
*   **指令周期**: 取指 -> 译码 -> 执行 -> 访存 -> 写回。
*   **数据通路 (Datapath)**: 指令执行过程中数据流经的路径（ALU, 总线, 寄存器）。
*   **控制器设计**:
    *   **组合逻辑控制器 (Hardwired)**: 速度快，设计复杂，不易修改。
    *   **微程序控制器 (Microprogrammed)**: 将控制信号编码为微指令存入控制存储器(CM)。执行指令=执行微程序。
        *   **微指令格式**: 水平型 (并行度高, 速度快, 指令长), 垂直型 (类似机器指令, 较短, 慢).
*   **流水线 (Pipeline)**:
    *   将指令执行过程分解为若干子过程（段），并行处理。
    *   **加速比 (Speedup)**:  = T_{seq} / T_{pipe}$。
    *   **冒险 (Hazards)**: 结构冒险 (资源冲突), 数据冒险 (依赖关系), 控制冒险 (跳转引起)。

#### 2. 常见考点
*   **指令流程分析**: 写出某条指令（如 ADD R1, (R2)）的微操作序列。
*   **流水线计算**: 给定段数和任务数，计算执行时间、加速比、吞吐率。
    *   $ 段流水线完成 $ 个任务的时间:  = (k + n - 1) \times \Delta t$。
*   **微指令格式**: 水平型 vs 垂直型特点对比。

#### 3. 典型题目与讲解
> **题目**: 某指令流水线分为 取指、译码、执行、写回 4段，每段耗时分别为 1ns, 1ns, 2ns, 1ns。求流水线的时钟周期和完成 100 条指令的时间。
>
> **讲解**:
> 1.  **时钟周期**: 取决于最慢的一段，$\Delta t = \max(1, 1, 2, 1) = 2ns$。
> 2.  **执行时间**:  = (4 + 100 - 1) \times 2ns = 103 \times 2 = 206ns$。
>    (注：若非流水线，单条需 +1+2+1=5ns$，100条需 00ns$)。

---

### 第4章 指令系统层 (80x86 CPU)

#### 1. 核心知识点
*   **寄存器组织**:
    *   **通用寄存器**: AX (累加), BX (基址), CX (计数), DX (数据), SI/DI (变址), SP/BP (指针)。
    *   **段寄存器**: CS (代码), DS (数据), SS (堆栈), ES (附加)。
    *   **标志寄存器 (FLAGS)**: ZF (零), SF (符), CF (进位), OF (溢出), IF (中断)。
*   **存储器分段**: 物理地址 = 段基址 $\times 16$ + 偏移量 (逻辑地址 Segment:Offset)。
*   **常用指令**:
    *   **传送**: MOV, PUSH, POP, XCHG.
    *   **算术**: ADD, SUB, INC, DEC, CMP (只改变标志位), MUL, DIV.
    *   **逻辑**: AND, OR, XOR, NOT, TEST.
    *   **串操作**: MOVS, STOS, LODS (配合 REP 前缀).

#### 2. 常见考点
*   **物理地址计算**: 给定 CS=2000H, IP=1000H, 求指令物理地址 (0000H + 1000H = 21000H$)。
*   **堆栈操作**: PUSH 时 SP 减小 (栈顶向低地址生长)，POP 时 SP 增大。
*   **标志位影响**: 哪些指令影响 ZF, CF (传送指令通常不影响标志位，CMP/TEST 专门用于设置标志位)。

#### 3. 典型题目与讲解
> **题目**: 执行指令 `MOV AX, 0` 和 `XOR AX, AX` 效果有何不同？
>
> **讲解**:
> *   两指令都能使 AX 变为 0。
> *   `MOV AX, 0` 机器码较长，**不影响标志位**。
> *   `XOR AX, AX` 机器码短，执行快，且**会清零 CF 和 OF，设置 ZF=1**。通常推荐用 XOR 清零。

---

### 第5章 汇编语言层

#### 1. 核心知识点
*   **语句格式**: `[标号:] 助记符 [操作数] [;注释]`
*   **伪指令 (Pseudo-ops)**:
    *   数据定义: DB (字节), DW (字), DD (双字), DUP (重复).
    *   段定义: SEGMENT ... ENDS.
    *   过程定义: PROC ... ENDP.
    *   ASSUME: 告诉汇编器段寄存器与段名的关联.
*   **程序结构**:
    *   **顺序/分支/循环**: 利用 JMP, JZ, JNE, LOOP 等指令实现。
    *   **子程序**: CALL 和 RET。注意现场保护 (PUSH/POP 寄存器)。
*   **DOS功能调用 (INT 21H)**:
    *   MOV AH, 01H (读字符), MOV AH, 02H (写字符), MOV AH, 09H (写字符串), MOV AH, 4CH (返回DOS)。

#### 2. 常见考点
*   **读程序**: 给定一段汇编代码，分析执行结果（如寄存器值、内存变化）。
*   **填空**: 补全实现特定功能（如数组求和、字符串复制）的代码。
*   **数据定义**: `DATA DW 10 DUP(?)` 分配了多少字节？ (10 * 2 = 20 bytes)。

#### 3. 典型题目与讲解
> **题目**: 编写汇编代码片段，计算 1+2+...+10，结果存入 AX。
>
> **讲解**:
> ```asm
>     MOV CX, 10      ; 循环次数
>     MOV AX, 0       ; 累加器清零
>     MOV BX, 1       ; 当前加数
> AGAIN:
>     ADD AX, BX
>     INC BX
>     LOOP AGAIN      ; CX--, 若 CX!=0 跳转
> ```


---

## 第三篇 存储系统和输入/输出系统

### 第6章 存储系统

#### 1. 核心知识点
*   **存储层次结构**: 寄存器 -> Cache -> 主存 -> 辅存。解决速度、容量、价格矛盾。
*   **SRAM vs DRAM**:
    *   **SRAM**: 速度快，不用刷新，集成度低，贵（做Cache）。
    *   **DRAM**: 速度慢，需刷新，集成度高，便宜（做主存）。
*   **主存扩展**:
    *   **位扩展**: 增加字长 (如 1Kx4 -> 1Kx8，需2片，数据线并联)。
    *   **字扩展**: 增加容量 (如 1Kx8 -> 2Kx8，需2片，地址线译码)。
*   **Cache (高速缓冲存储器)**:
    *   **局部性原理**: 时间局部性 (循环), 空间局部性 (数组)。
    *   **映射方式**:
        *   **直接映射**: 简单，冲突率高。
        *   **全相联**: 灵活，比较器电路复杂。
        *   **组相联**: 折中方案 (如 2-way, 4-way)。
    *   **写策略**: 写回法 (Write Back), 写直达法 (Write Through).
*   **虚拟存储器**:
    *   逻辑地址 -> MMU -> 物理地址。
    *   **页式管理**: 固定大小的页。TLB (快表) 加速地址转换。

#### 2. 常见考点
*   **Cache 映射计算**: 给定主存地址格式，求 Tag、Index (Set)、Offset 位数。
*   **存储扩展设计**: 画图或计算所需芯片数量，连接片选信号 (CS)。
*   **平均访问时间**: {avg} = H \times T_{cache} + (1-H) \times T_{mem}$。

#### 3. 典型题目与讲解
> **题目**: 某计算机 Cache 容量 16KB，块大小 32B，采用 2路组相联映射。主存地址 32位。求 Tag、Index、Offset 各多少位？
>
> **讲解**:
> 1.  **块内偏移 (Offset)**: 块大小 32B -> ^5$，所以 Offset = 5位。
> 2.  **组数 (Index)**: Cache 容量 / 块大小 / 路数 = 6KB / 32B / 2 = 512 / 2 = 256$ 组。
> 3.  56 = 2^8$，所以 Index = 8位。
> 4.  **标记 (Tag)**: 剩余位 = 2 - 8 - 5 = 19$位。

---

### 第7章 输入/输出系统

#### 1. 核心知识点
*   **I/O 控制方式**:
    *   **程序查询 (Polling)**: CPU 忙等，效率低。
    *   **程序中断 (Interrupt)**: 外设准备好发请求，CPU 暂停当前程序去处理。支持并行。
    *   **DMA (直接存储器访问)**: 专用控制器控制内存与外设直接数据传输，仅在开始和结束需CPU干预。适合大数据块传输（磁盘）。
    *   **通道/IOP**: 更高级的专用I/O处理器。
*   **中断过程**: 请求 -> 判优 -> 响应 -> 保护现场 -> 中断服务 -> 恢复现场 -> 返回。
    *   **中断向量**: 中断服务程序的入口地址。
*   **总线 (Bus)**:
    *   数据总线 (DB), 地址总线 (AB), 控制总线 (CB)。
    *   **总线带宽**: 单位时间传输的数据量 ( = f \times Width / 8$).

#### 2. 常见考点
*   **方式对比**: 查询 vs 中断 vs DMA 的 CPU 占用率、适用场景。
*   **中断优先级**: 硬件判优 (链式查询) vs 软件判优。中断嵌套。
*   **带宽计算**: 总线频率 33MHz，位宽 32位，求带宽。
    *   3 \times 10^6 \times 32 / 8 = 132 MB/s$。

#### 3. 典型题目与讲解
> **题目**: 下列关于 DMA 的说法，正确的是？
> A. DMA 不需要 CPU 参与
> B. DMA 方式下，CPU 与 外设串行工作
> C. DMA 优先级通常高于外部中断请求
> D. DMA 只能用于数据输入
>
> **讲解**:
> *   A 错，DMA 初始化和结束处理需 CPU。
> *   B 错，DMA 的目的就是并行。
> *   C 对，DMA 请求通常在总线周期结束后响应（窃取周期），而中断在指令周期结束响应，且 DMA 处理高速设备，优先级高。
> *   D 错，双向。
> *   **答案**: C

---
